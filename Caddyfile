:{$PORT} {
  log {
    format json
  }

  respond /health "gateway-ok" 200

  # =========================
  # CORS Preflight (WeWeb Editor, Browser)
  # =========================
  @preflight method OPTIONS
  handle @preflight {
    header Access-Control-Allow-Origin "*"
    header Access-Control-Allow-Methods "GET, POST, OPTIONS"
    header Access-Control-Allow-Headers "Content-Type, Authorization, X-Request-Id"
    header Access-Control-Max-Age "86400"
    respond "" 204
  }

  # Optional: CORS Header auch für normale Responses am Gateway ergänzen
  header {
    Access-Control-Allow-Origin "*"
    Access-Control-Allow-Headers "Content-Type, Authorization, X-Request-Id"
    Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Access-Control-Max-Age "86400"
  }

  # =========================
  # AI_CHAT -> ai-chat (Prefix bleibt erhalten)
  # =========================
  handle /ai_chat/* {
    reverse_proxy ai-chat.railway.internal:8080 {
      flush_interval -1
      transport http {
        dial_timeout 30s
        response_header_timeout 0
        read_timeout 0
        write_timeout 0
      }
    }
  }

  # =========================
  # IMAGE -> ai-image (Prefix bleibt erhalten)
  # =========================
  handle /image/* {
    reverse_proxy ai-image.railway.internal:8080
  }

  respond "Not found" 404
}