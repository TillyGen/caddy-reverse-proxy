# Routes:
# - api.tillygen.de/chat/*  -> chat-service
# - api.tillygen.de/image/* -> image-service
#
# NOTE:
# - handle_path removes the prefix (/chat or /image) before forwarding.
#   Example: /chat/messages -> /messages on chat-service
# - If you want to keep the prefix, replace handle_path with handle.

api.tillygen.de {
	encode gzip zstd

	# Basic health endpoint
	handle /health {
		respond "ok" 200
	}

	# CHAT
	handle_path /chat/* {
		reverse_proxy chat-service.railway.internal:8080 {
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
			header_up X-Forwarded-For {remote_host}
		}
	}

	# IMAGE
	handle_path /image/* {
		reverse_proxy image-service.railway.internal:8080 {
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
			header_up X-Forwarded-For {remote_host}
		}
	}

	# Fallback
	respond "Not found" 404
}
